<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Products Sync</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h2 {
            margin-top: 0;
            color: #333;
        }
        .product-list {
            list-style: none;
            padding: 0;
        }
        .product-item {
            padding: 10px;
            margin: 10px 0;
            background: #f9f9f9;
            border-left: 4px solid #58c234;
            border-radius: 4px;
        }
        .product-item strong {
            color: #58c234;
        }
        .button-group {
            margin: 20px 0;
        }
        button {
            background: #58c234;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            font-size: 14px;
        }
        button:hover {
            background: #4a9d2a;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            border-left: 4px solid #2196f3;
        }
        .success {
            background: #c8e6c9;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            color: #2e7d32;
        }
    </style>
</head>
<body>
    <h1>üîÑ Products Sync Test</h1>
    
    <div class="info">
        <strong>Instructions:</strong>
        <ol>
            <li>Open this page in two browser tabs</li>
            <li>Click "Add Test Product" in one tab</li>
            <li>Check if it appears in the other tab automatically</li>
            <li>Try deleting a product and see if it syncs</li>
        </ol>
    </div>

    <div class="container">
        <div class="panel">
            <h2>üìã Current Products</h2>
            <ul id="productsList" class="product-list"></ul>
            <div class="button-group">
                <button onclick="addTestProduct()">+ Add Test Product</button>
                <button onclick="deleteFirstProduct()">üóëÔ∏è Delete First</button>
                <button onclick="resetProducts()">‚Üª Reset to Default</button>
            </div>
        </div>

        <div class="panel">
            <h2>üìä Sync Status</h2>
            <div id="status"></div>
            <div class="button-group">
                <button onclick="checkStorage()">Check Storage</button>
                <button onclick="clearStorage()">Clear Storage</button>
            </div>
        </div>
    </div>

    <script src="js/products-data.js"></script>
    <script>
        let testCounter = 1;

        function renderProducts() {
            const list = document.getElementById('productsList');
            const products = ProductsManager.getProducts();
            
            list.innerHTML = '';
            if (products.length === 0) {
                list.innerHTML = '<li class="product-item">No products</li>';
                return;
            }

            products.forEach(p => {
                const li = document.createElement('li');
                li.className = 'product-item';
                li.innerHTML = `
                    <strong>${p.title}</strong><br>
                    Category: ${p.category} | Price: Rp ${p.price.toLocaleString('id-ID')} | 
                    <button onclick="deleteProduct(${p.id})" style="padding: 5px 10px; font-size: 12px;">Delete</button>
                `;
                list.appendChild(li);
            });

            updateStatus();
        }

        function addTestProduct() {
            const product = {
                title: `Test Product ${testCounter++}`,
                category: 'Test',
                price: Math.floor(Math.random() * 500000) + 10000,
                image: 'https://via.placeholder.com/200',
                popular: Math.random() > 0.5,
                phone: '+628123456789'
            };

            ProductsManager.addProduct(product);
            renderProducts();
            showSuccess('Product added!');
        }

        function deleteProduct(id) {
            ProductsManager.deleteProduct(id);
            renderProducts();
            showSuccess('Product deleted!');
        }

        function deleteFirstProduct() {
            const products = ProductsManager.getProducts();
            if (products.length > 0) {
                deleteProduct(products[0].id);
            }
        }

        function resetProducts() {
            ProductsManager.resetToDefaults();
            testCounter = 1;
            renderProducts();
            showSuccess('Reset to defaults!');
        }

        function checkStorage() {
            const stored = localStorage.getItem(ProductsManager.storageKey);
            const products = ProductsManager.getProducts();
            updateStatus(`
                <strong>Storage Check:</strong><br>
                Total Products: ${products.length}<br>
                Storage Size: ${stored ? (stored.length / 1024).toFixed(2) : 0} KB<br>
                Last Updated: ${new Date().toLocaleTimeString()}
            `);
        }

        function clearStorage() {
            localStorage.removeItem(ProductsManager.storageKey);
            renderProducts();
            showSuccess('Storage cleared!');
        }

        function updateStatus(message = '') {
            const status = document.getElementById('status');
            if (!message) {
                const products = ProductsManager.getProducts();
                message = `
                    <strong>‚úì Sync Active</strong><br>
                    Products Loaded: ${products.length}<br>
                    Last Update: ${new Date().toLocaleTimeString()}<br>
                    <br>
                    <em>Open this page in another tab to test sync</em>
                `;
            }
            status.innerHTML = message;
        }

        function showSuccess(msg) {
            const div = document.createElement('div');
            div.className = 'success';
            div.textContent = msg;
            document.body.insertBefore(div, document.body.firstChild);
            setTimeout(() => div.remove(), 2000);
        }

        // Listen for updates
        window.addEventListener('productsUpdated', () => {
            renderProducts();
            showSuccess('üì° Sync detected from another tab!');
        });

        // Initial render
        renderProducts();
    </script>
</body>
</html>

